#!/bin/bash

APICAST_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )/.." && pwd )"

if (which luarocks 2>&1 > /dev/null); then
  eval `luarocks path`
fi

NGINX_BINARY=${APICAST_NGINX_BINARY:-nginx}
log_level=${APICAST_LOG_LEVEL:-warn}
log_file=${APICAST_LOG_FILE:-stderr}

mkdir -p "${APICAST_DIR}/logs"

exec ${NGINX_BINARY} -p ${APICAST_DIR} -c conf/nginx.conf -g "daemon off; error_log ${log_file} ${log_level};"
