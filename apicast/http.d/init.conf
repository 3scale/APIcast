init_by_lua_block {
    -- require("jit.v").start("dump.txt")
    -- require('jit.p').start('vl')
    -- require('jit.dump').start('bsx', 'jit.log')

    -- backported https://github.com/openresty/luajit2/commit/99304a93bb661b3f3afbe4c54d50c705e14c35a3
    jit.opt.start("maxtrace=8000", "maxrecord=16000", "minstitch=3", "maxmcode=40960")

    pcall(require, 'luarocks.loader')

    require("resty.core")
    require('resty.resolver').init()

    local module = require('module')

    if not module then
      ngx.log(ngx.EMERG, 'fatal error when loading the root module')
      os.exit(1)
    end

    module:init()

    collectgarbage("collect")
}

init_worker_by_lua_block {
    require('module'):init_worker()
}

lua_shared_dict init 16k;
